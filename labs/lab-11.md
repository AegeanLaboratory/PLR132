[![Hits](https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Feffie375.github.io%2FTPTE-AEGEAN&count_bg=%23E3802B&title_bg=%2307359E&icon=internetarchive.svg&icon_color=%23E7E7E7&title=%CE%A0%CF%81%CE%BF%CE%B2%CE%BF%CE%BB%CE%AD%CF%82&edge_flat=false)](https://hits.seeyoufarm.com)

# Εργαστήριο 11

Το εργαστηριακό μάθημα αυτό είναι απο τη σημερινή παρουσίαση (17/05/2021) που μας έκανε ο κ. Νίκος Μ. Χατζηγιαννάκης (Πανεπιστήμιο ΑΙΓΑΙΟΥ). Το περιεχόμενο του 11ου εργαστηρίου είναι το εξής:

- Διαχείριση αρχείων κειμένου
- Εγγραφή και ανάγνωση αρχείων κειμένου

## Άσκηση 11.1 - Ανάγνωση κρυπτογραφημένου αρχείου

Ο συμπιεσμένος φάκελος **joke.zip** που συνοδεύει το εργαστήριο περιέχει το αρχείο **joke.txt** το οποίο περιέχει ένα **κρυπτογραφημένο ανέκδοτο**. Κατεβάστε τον συμπιεσμένο φάκελο και αποθηκεύεστε τον στο φάκελο My Documents. Εξάγετε το
αρχείο **joke.txt** και αποθηκεύεστε το και αυτό στο φάκελο My Documents. Ανοίξτε το αρχείο με το σημειωματάριο να δείτε τι έχει μέσα.

### Βήμα 1

- Κρυπτογράφηση του αρχείου είναι πολύ απλή. Αντί για τον κανονικό χαρακτήρα στο αρχείο έχει γραφεί ο επόμενος. Π.χ αντί για a γράφηκε b αντί για d το e κ.ο.κ Γενικά στο αρχείο γράφηκε ο χαρακτήρας με κωδικό τον αμέσως επόμενο (+1) από αυτόν που θα έπρεπε να γραφεί!
- Να γραφεί πρόγραμμα **lab11_1.c** το οποίο θα ανοίγει το αρχείο **joke.txt**, και θα εμφανίζει τα περιεχόμενα του στην οθόνη αποκρυπτογραφημένα. **ΠΡΟΣΟΧΗ** να αποθηκεύστε το πηγαίο αρχείο lab11_1.c στον ίδιο φάκελο που βρίσκεται το **joke.txt**, και μετά μεταγλωττίστε και εκτελέστε το πρόγραμμα.

```c
#include <stdio.h>

int main()
{
    FILE *joke;
    char ch;

    joke = fopen("joke.txt", "r");

    if(joke==NULL) exit(2);
    while(ch!=EOF)
    {
        ch = fgetc(joke);
        putchar(ch-1);
    }

    fclose(joke);

    return 0;
}
```

## Άσκηση 11.2 - Εγγραφή των στοιχείων σας σε αρχείο

Αντικείμενο της άσκησης 11.2 είναι η εγγραφή και η ανάγνωση των προσωπικών σας στοιχείων σε αρχείο!

### Βήμα 1

- Να γραφεί πρόγραμμα **lab11_2.c** το οποίο θα εγγράφει τα προσωπικά σας στοιχεία σε ένα **αρχείο κειμένου** με όνομα **info.txt**.
- Στη **πρώτη** γραμμή θα πρέπει να εγγραφεί το **ονοματεπώνυμο** σας
(σε greeklish)
- Στη **δεύτερη** γραμμή θα πρέπει να εγγραφεί ο **κωδικός** σας (ct...)
- Στη **τρίτη** γραμμή η **ηλικία** σας
- Στη **τέταρτη** γραμμή το **βάρος** και το **ύψος** σας
- Μόλις εγγραφούν τα στοιχεία θα πρέπει να **κλείσετε** το αρχείο
- **Εκτελέστε** το πρόγραμμα σας και ελέγξτε αν **δημιουργήθηκε** το
αρχείο info.txt. Ανοίξτε το με το **σημειωματάριο** (notepad)

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
    FILE *fp;

    fp=fopen("info.txt","w");
    fputs("Yoda\n",fp);
    fputs("CT20000\n",fp);
    fprintf(fp,"19\n39 1.54");
    fclose(fp);
    return 0;
}
```

### Βήμα 2

Στη συνέχεια του προγράμματος να ανοίγει πάλι το αρχείο info.txt για ανάγνωση. Να διαβάζει τα στοιχεία (ονοματεπώνυμο,κωδικό,ηλικία,βάρος και ύψος) που βρίσκονται στο αρχείο και να τα εμφανίζει στην οθόνη. Προσθέστε στο πρόγραμμα τις κατάλληλες δηλώσεις μεταβλητών και πινάκων
που χρειάζονται για την αποθήκευση των στοιχείων που θα αναγνωστούν.

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
    FILE *fp;

    int age;
    float b,y;
    char onom[30],code[10];

    fp=fopen("info.txt","w");

    fputs("Yoda\n",fp);
    fputs("CT20000\n",fp);
    fprintf(fp,"19\n85 1.82");

    fclose(fp);

    fp=fopen("info.txt","r");

    fgets(onom,30,fp);
    fgets(code,10,fp);
    fscanf(fp,"%d %f %f",&age,&b,&y);
    printf("%s\n",onom);
    printf("%s\n",code);
    printf("%d\n%f %f\n",age,b,y);

    fclose(fp);
    return 0;
}
```

## Άσκηση 11.3 - Εγγραφή μορφοποιημένων στοιχείων σε αρχείο

Αντικείμενο της άσκησης 11.3 είναι η εγγραφή σε αρχείο των αποτελεσμάτων μιας εξεταστικής 5 φοιτητών σε 4 μαθήματα. Ακόλουθα ζητείται η ανάγνωση των στοιχείων.

### Βήμα 1

- Να γραφεί πρόγραμμα **lab11_3α.c** το οποίο θα ζητάει να πληκτρολογήσουμε το ονοματεπώνυμο ενός φοιτητή καθώς και τους 4 βαθμούς του. Τόσο το ονοματεπώνυμο όσο και τους βαθμούς θα πρέπει να τους **εγγράφει** σε ένα **αρχείο κειμένου** με όνομα **apot.txt**.
- Η διαδικασία αυτή θα πρέπει να επαναλαμβάνεται για **5** φοιτητές.
- Η **γραμμογράφηση** του αρχείου φαίνεται παρακάτω:

```c
TEMPELAS NIKOLAOS
4 5.5 6 2
ARAXTH MARIA
3 2.5 2 2
MPAROBIOS IOANNHS
4 4 1.5 5
.....
.....
```

- Μόλις εγγραφούν τα στοιχεία και των 5 φοιτητών θα πρέπει να **κλείσετε** το αρχείο apot.txt.
- **Εκτελέστε** το πρόγραμμα σας και **ελέγξτε** αν δημιουργήθηκε το αρχείο apot.txt. **Ανοίξτε** το με το **σημειωματάριο** (notepad).


```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
    FILE *fp;

    int i;
    float b1,b2,b3,b4;
    char onom[30];

    fp=fopen("apot.txt","w");

    for (i=1;i<=5;i++)
    {
        gets(onom);
        fputs(onom,fp);
        scanf("%f %f %f %f",&b1,&b2,&b3,&b4);
        fflush(stdin);             
        fprintf(fp,"\n%f %f %f %f\n",b1,b2,b3,b4);
    }

    fclose(fp);
    return 0;
}
```

### Βήμα 2

Να γραφεί **ΝΕΟ** πρόγραμμα **lab11_3b.c** το οποίο θα ανοίγει το αρχείο κειμένου **apot.txt** θα διαβάζει τα ονόματα και τους βαθμούς των 5 φοιτητών και θα τα εμφανίζει στην οθόνη.

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
    FILE *fp;

    int i;
    float b1,b2,b3,b4;
    char onom[30];

    fp=fopen("apot.txt","r");

    for (i=1;i<=5;i++)
    {
        fgets(onom,30,fp);
        printf("%s",onom);
        fscanf(fp,"%f %f %f %f ",&b1,&b2,&b3,&b4);
        printf("%f %f %f %f\n",b1,b2,b3,b4);
    }

    fclose(fp);
    return 0;
}
```

### Βήμα 3

Τροποποιήστε το πρόγραμμα **lab11_3b.c** ώστε να διαβάζει και να εμφανίζει τα στοιχεία του αρχείου ανεξαρτήτως του πλήθους των φοιτητών. Δηλαδή **χωρίς** να γνωρίζουμε το πλήθος των φοιτητών των οποίων τα στοιχεία είναι καταγεγραμμένα στο αρχείο **apot.txt**.

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
    FILE *fp;

    int i;
    float b1,b2,b3,b4;
    char onom[30];

    fp=fopen("apot.txt","r");

    while(!feof(fp))
    {
        fgets(onom,30,fp);
        printf("%s",onom);
        fscanf(fp,"%f %f %f %f ",&b1,&b2,&b3,&b4);
        printf("%f %f %f %f\n",b1,b2,b3,b4);
    }
    fclose(fp);

    return 0;
}
```

## Άνοιγμα αρχείου με την fopen()

Η **fopen()** εξυπηρετεί δύο σκοπούς: Αφενός ανοίγει ένα αρχείο και αφετέρου επιστρέφει ένα
δείκτη τύπου FILE, ο οποίος προσδιορίζει το συγκεκριμένο κανάλι επικοινωνίας με το οποίο
συνέδεσε το αρχείο.

Το συντακτικό της fopen() είναι το εξής:

```c
FILE *fopen(char *όνομα_αρχείου, char *τρόπος)
```

Η fopen() επιστρέφει ένα **δείκτη** τύπου **FILE** (o τύπος αυτός ορίζεται στο αρχείο κεφαλίδας stdio.h).

Ο γενικός τρόπος χρήσης της fopen() είναι ο ακόλουθος:

**FILE** *fp;
fp = fopen(όνομα.αρχείου,τρόπος);

όπου **όνομα.αρχείου** είναι ένα σύνολο χαρακτήρων με το όνομα του αρχείου που σκοπεύουμε να
ανοίξουμε και **τρόπος** ένα σύνολο χαρακτήρων που καθορίζει τον τρόπο με τον οποίο θα ανοιχτεί
το συγκεκριμένο αρχείο. Οι διάφοροι τρόποι αναφέρονται στον επόμενο πίνακα.

Ο δείκτης που επιστρέφει η **fopen()** καταχωρίζεται σε μια μεταβλητή δείκτη τύπου **FILE** (όπως η fp στο παράδειγμα). **Μέσω** του δείκτη αυτού γίνεται πλέον ο **χειρισμός** του αρχείου.

## Τρόποι 'ανοίγματος' αρχείου

|Τρόπος|Λειτουργία|Φορά|Θέση|
|:-:|:-|:-:|:-:|
|"r" |Ανοίγει ένα αρχείο κειμένου για ανάγνωση|⇦|⬈:file_folder:|
|"w"|Δημιουργεί ένα αρχείο κειμένου για εγγραφή|⇨|⬈:file_folder:|
|"a"|Προσθέτει στο τέλος ενός αρχείου κειμένου|⇨⇨|⬊:file_folder:|
|"rb"|Ανοίγει ένα δυαδικό αρχείο για ανάγνωση|⇦|⬈:file_folder:|
|"wb"|Δημιουργεί ένα δυαδικό αρχείο για εγγραφή|⇨|⬈:file_folder:|
|"ab"|Προσθέτει στο τέλος ενός δυαδικού αρχείου|⇨⇨|⬊:file_folder:|
|"r+"|Ανοίγει ένα αρχείο κειμένου για ανάγνωση/εγγραφή|⬄|⬈:file_folder:|
|"w+"|Δημιουργεί ένα αρχείο κειμένου για ανάγνωση/εγγραφή|⬄|⬈:file_folder:|
|"a+"|Ανοίγει ένα αρχείο κειμένου για ανάγνωση/εγγραφή|⬄|⬊:file_folder:|
|"rb+"|Ανοίγει ένα δυαδικό αρχείο για ανάγνωση/εγγραφή|⬄|⬈:file_folder:|
|"wb+"|Δημιουργεί ένα δυαδικό αρχείο για ανάγνωση/εγγραφή|⬄|⬈:file_folder:|
|"ab+"|Ανοίγει ένα δυαδικό αρχείο για ανάγνωση/εγγραφή|⬄|⬊:file_folder:|

- Η στήλη **φορά** δείχνει την **κατεύθυνση** των **δεδομένων** (από ή προς το αρχείο ή και τα δύο). Τα δύο βέλη δείχνουν προσθήκη στο τέλος του αρχείου.
- Η στήλη **θέση** δείχνει την αρχική **θέση** του **δείκτη θέσης** του αρχείου: στην αρχή (⬈:file_folder:) ή στο τέλος του (⬊:file_folder:).
- Όταν ανοίξουμε ένα αρχείο για εγγραφή και το αρχείο δεν υπάρχει τότε **δημιουργείται**!

## Τρόποι χρήσης της fopen()

Δείκτης χειρισμού του αρχείου. Θα μπορούσε να έχει οποιοδήποτε αποδεκτό όνομα.

```c
FILE *fp;
```

Ανοίγει ένα αρχείο κειμένου με όνομα **data** για ανάγνωση δεδομένων.

```c
fp=fopen("data","r");
```

**Με τον τρόπο αυτό, ταυτόχρονα με το άνοιγμα του αρχείου, ελέγχεται και αν η διαδικασία ήταν επιτυχής**:

Στη περίπτωση που η συνάρτηση fopen() επιστρέψει δείκτη **NULL**, σημαίνει ότι υπήρξε **πρόβλημα** στο άνοιγμα του αρχείου.

```c
FILE *fp;

if((fp=fopen("data","r")) == NULL)
{
    puts("Πρόβλημα στο άνοιγμα του αρχείου");
    exit(2);
}
```

Για να "συνδέσουμε" ένα κανάλι με ένα αρχείο χρησιμοποιούμε τη συνάρτηση **fopen()**. Η fopen() επιστρέφει ένα δείκτη τύπου **FILE**, ο οποίος προσδιορίζει το συγκεκριμένο κανάλι επικοινωνίας. Ο δείκτης αυτός χρησιμοποιείται για την αναφορά σε αυτό το αρχείο, για **όλες** τις ενέργειες που αφορούν το συγκεκριμένο αρχείο. Στη περίπτωση που η συνάρτηση fopen() αντιμετωπίσει οποιοδήποτε **πρόβλημα** στο άνοιγμα του αρχείου επιστρέψει δείκτη **NULL**!

## Η συνάρτηση fgetc()

Η συνάρτηση **fgetc()** διαβάζει **έναν** χαρακτήρα από ένα αρχείο. Η συνάρτηση επιστέφει ως τιμή τον χαρακτήρα που διάβασε. Το συντακτικό της είναι:

```c
int fgetc(FILE *fp)
```

όπου **ch** ο χαρακτήρας που θα γραφεί στο αρχείο.

Ο παρακάτω κώδικας:

- Ανοίγει το αρχείο text.txt ως αρχείο κειμένου, για ανάγνωση πληροφοριών.
- Διαβάζει έναν-έναν τους χαρακτήρες
από το αρχείο μέχρι να διαβάσει τον
χαρακτήρα EOF.
- Κλείνει το αρχείο και απελευθερώνει
το κανάλι fp!

```c
FILE *fp;

char ch;

fp=fopen("text.txt","r");

if (fp==NULL) exit(2);

while(ch!=EOF)
{
    ch=fgetc(fp);
    putchar(ch);
}
fclose(fp);
.....
```

Η συνάρτηση **fgetc()** επιστρέφει ένα χαρακτήρα **"end-of-file"** ("τέλος αρχείου") όταν φτάσει στο τέλος του αρχείου. Στο stdio.h έχει ανατεθεί η τιμή του χαρακτήρα "end-of-file" στο σύμβολο **EOF**.

## Παραδείγματα με fputc() και fgetc()

```c
char lex[20]="MYTILHNH",ch='';

FILE *fp1;

fp1=fopen("text.txt","w");

for (i=0;i<strlen(lex);i++)
fputc(lex[i],fp1);
fclose(fp1);
.....

fp1=fopen("text.txt","r");
while(ch!=EOF)
{
    ch=fgetc(fp1);
    putchar(ch);
}

fclose(fp1);
.....
```

Ο παραπάνω κώδικας, ανοίγει το αρχείο κειμένου text.txt για εγγραφή. Μετά εγγράφει ένανέναν τους χαρακτήρες του πίνακα lex μέσα στο αρχείο και κλείνει το αρχείο. Ακόλουθα ανοίγει το ίδιο αρχείο για διάβασμα, και διαβάζει έναν-έναν τους χαρακτήρες και τους εμφανίζει στην οθόνη. Η διαδικασία σταματάει όταν διαβάσει και τον χαρακτήρα EOF.

## Η συνάρτηση fprintf()

Η συνάρτηση **fprintf()** συμπεριφέρεται όπως η **printf()**, με τη διαφορά ότι αντί να εμφανίσει τα αποτελέσματά της στην οθόνη, τα γράφει σε αρχείο. Το συντακτικό της είναι το ακόλουθο:

```c
int fprintf(FILE *fp, char *αλφ_μορφ, παρ1, παρ2, ....)
```

O παρακάτω κώδικας:

- Ανοίγει το αρχείο **tyxaioi.txt** ως αρχείο κειμένου, για **εγγραφή** πληροφοριών.
- Μέσα στο αρχείο εγγράφονται 100
τυχαίοι αριθμοί.
- Κλείνει το αρχείο

```c
.....
FILE *fp;

int i;

fp=fopen("tyxaioi.txt","w");

for(i=1;i<=100;i++)
    fprintf(fp,"%d\n",rand());

fclose(fp);
.....
```

Τα αποτελέσματα της fprintf() (δηλαδή ότι θα εμφάνιζε η αντίστοιχη printf() στην οθόνη) εγγράφονται στο αρχείο που καθορίζεται από το δείκτη fp. Η fprintf() επιστρέφει τον αριθμό των χαρακτήρων που έγραψε στο αρχείο.

## Η συνάρτηση fscanf()

Η συνάρτηση **fscanf()** συμπεριφέρεται όπως η scanf(), με τη διαφορά ότι διαβάζει
μορφοποιημένα δεδομένα, όχι από το πληκτρολόγιο αλλά από αρχείο. Το συντακτικό της είναι:

```c
int fscanf(FILE *fp, char *αλφ_μορφ, δνση1, δνση2, ....)
```

O παρακάτω κώδικας:

- Ανοίγει το αρχείο **tyxaioi.txt** ως
αρχείο κειμένου, για **ανάγνωση**
πληροφοριών.
- Διαβάζει έναν αριθμό από το αρχείο και τον καταχωρίζει στη μεταβλητή ar. Αυτό γίνεται 100 φορές!
- Εμφανίζει στην οθόνη τον αριθμό που διάβασε.
- Κλείνει το αρχείο

```c
.....

FILE *fp;

int i,ar;

fp=fopen("tyxaioi.txt","r");

for(i=1;i<=100;i++)
{
    fscanf(fp,"%d",&ar);
    printf("%d\n",ar);
}

fclose(fp);
.....
```

Για να δουλέψει η fscanf() σωστά, προϋποθέτει ότι το αρχείο περιέχει τα δεδομένα με κάποιο μορφοποιημένο τρόπο (όπως αν δίνονταν από το πληκτρολόγιο).

## Η συνάρτηση fscanf() - παράδειγμα

Ο παρακάτω κώδικας διαβάζει από το αρχείο **data.txt** τρεις αριθμούς και τους καταχωρίζει στις μεταβλητές a, b και c αντίστοιχα.

```c
.....

FILE *fp;

int a,b,c;

fp=fopen("data.txt","r");
fscanf(fp,"%d %d %d",&a,&b,&c);
.....
```

Οι αριθμοί χωρίζονται μεταξύ τους με κενά και χαρακτήρες αλλαγής γραμμής!

```
10 20
30
```

Η fscanf() εκλαμβάνει τους χαρακτήρες **λευκού διαστήματος**, ως χαρακτήρες **διαχωρισμού** των δεδομένων του αρχείου. Οι χαρακτήρες αυτοί είναι: ο χαρακτήρας του διαστήματος, ο
χαρακτήρας **αλλαγής γραμμής** και ο χαρακτήρας **tab**. Επομένως, τα διαφορετικά δεδομένα ενός αρχείου **πρέπει** να διαχωρίζονται από αυτούς τους χαρακτήρες για να μπορούν να
αναγνωστούν από τη συνάρτηση fscanf().

## Χαρακτήρες λευκού διαστήματος

Υποθέστε ότι σε ένα αρχείο θέλουμε να εγγράψουμε τα εξής:Τον αριθμό 23, τον αριθμό 32.5,τη λέξη LESVOS, τον αριθμό 24, το 56, τη λέξη MYTILINH, το 25 το 56 και τη λέξη TELOS.

- Λάθος τρόπος. Τα δεδομένα δεν θα μπορούν να διαβαστούν!

```
2532.5LESVOS
2456MYTILINH2556
TELOS
```

- Σωστός τρόπος. Τα δεδομένα χωρίζονται με χαρακτήρες λευκού διαστήματος.

```
25 32.5 LESVOS
24 56 MYTILINH
25
56
TELOS
```

Τα διαφορετικά μορφοποιημένα δεδομένα ενός αρχείου κειμένου πρέπει να διαχωρίζονται από χαρακτήρες λευκού διαστήματος για να μπορούν να αναγνωστούν από τη συνάρτηση fscanf(). Οι χαρακτήρες αυτοί είναι: ο χαρακτήρας του διαστήματος, ο χαρακτήρας αλλαγής γραμμής και ο χαρακτήρας tab. **Όταν εγγράφουμε δεδομένα μέσα σε ένα αρχείο πάντα πρέπει να σκεφτόμαστε πως θα τα διαβάσουμε**!

## Παράδειγμα εγγραφής μορφοποιημένων δεδομένων σε αρχείο

Υποθέστε ότι σε ένα αρχείο θέλουμε να εγγράψουμε τα εξής:Τον αριθμό 23, τον αριθμό 32.5,τη λέξη LESVOS, τον αριθμό 24, το 56, τη λέξη MYTILINH, το 25 το 56 και τη λέξη TELOS.

```c
.....
int a=23,b=24,c=56,d=25,e=56;
float z=32.5;
char lex1[10]="LESVOS",lex2[10]="MYTILINI";

FILE *fp;

fp=fopen("text.txt","w");

fprintf(fp,"%d %f %s\n",a,z,lex1);
fprintf(fp,"%d %d %s\n",b,c,lex2);
fprintf(fp,"%d\n%d\nTELOS",d,e);

fclose(fp);
.....
```

Στο αρχείο θα εμφανιστεί:

```
25 32.5 LESVOS
24 56 MYTILINH
25
56
TELOS
```

**Όταν εγγράφουμε μορφοποιημένα δεδομένα μέσα σε ένα αρχείο πάντα πρέπει να σκεφτόμαστε πως θα τα διαβάσουμε**!

## Παράδειγμα ανάγνωσης μορφοποιημένων δεδομένων από αρχείο

Ο παρακάτω κώδικας διαβάζει τα μορφοποιημένα δεδομένα που υπάρχουν στο αρχείο text.txt και τα εμφανίζει στην οθόνη!

```c
int a,b,c,d,e;
float z;
char lex1[10],lex2[10],lex3[10];

FILE *fp;

fp=fopen("text.txt","r");

fscanf(fp,"%d %f %s",&a,&z,lex1);
fscanf(fp,"%d %d %s",&b,&c,lex2);
fscanf(fp,"%d %d %s",&d,&e,lex3); // Διαβάζει δεδομένα από το αρχείο και τα καταχωρίζει στις μεταβλητές a,b,c,d,e,z και στους πίνακες lex1, lex2 και lex3.

fclose(fp);
printf("%d %f %s\n",a,z,lex1); // Εμφανίζει τα δεδομένα που διάβασε στην οθόνη
printf("%d %d %s\n",b,c,lex2);
printf("%d\n%d\n%s\n",d,e,lex3);
.....
```

## Η συνάρτηση feof()

Η συνάρτηση **feof()** επιστρέφει τιμή ψέμα (0) όταν δεν έχουμε φτάσει στο **τέλος** ενός **αρχείου**, και τιμή διάφορη του 0 και σε κάθε άλλη περίπτωση. Το συντακτικό της είναι:

```c
int feof(FILE *fp)
```

Στο παρακάτω κομμάτι κώδικα:

- Ανοίγει το αρχείο **DATA** ως αρχείο κειμένου, για ανάγνωση πληροφοριών.
- **Διαβάζονται** ένας-ένας οι χαρακτήρες του αρχείου μέχρι η συνάρτηση feof() να επιστρέψει τιμή Αλήθεια. Τότε έχουμε φτάσει στο **τέλος** του αρχείου και **διακόπτεται** η διαδικασία ανάγνωσης.
- **Εμφανίζει** στην οθόνη τον χαρακτήρα που διάβασε.
- **Κλείνει** το αρχείο

```c
.....
fp=fopen("DATA","r");

while(!feof(fp))
{
    ch=fgetc(fp);
    putch(ch);
}
fclose(fp);
.....
```

Για να μπορέσουμε να διαβάσουμε τον **χαρακτήρα EOF** θα πρέπει να διαβάσουμε το αρχείο **χαρακτήρα-χαρακτήρα**. Στην περίπτωση όμως που το αρχείο περιέχει αριθμούς, ή άλλα μορφοποιημένα δεδομένα, δεν μπορούμε να το διαβάσουμε χαρακτήρα-χαρακτήρα, και η χρήση της συνάρτησης **feof()** είναι ο μοναδικός τρόπος για να διαπιστώσουμε αν έχουμε
φτάσει στο **τέλος** του αρχείου.

## Η συνάρτηση fgets()

H **fgets()** λειτουργεί σχεδόν όπως η gets(), με τη διαφορά ότι διαβάζει ένα σύνολο χαρακτήρων από ένα αρχείο και όχι από το πληκτρολόγιο. Το συντακτικό της είναι:

```c
fgets(char *str, int mikos, FILE *fp)
```

όπου ο δείκτης **str** δείχνει την πρώτη από τις θέσεις μνήμης όπου θα
αποθηκευτούν οι χαρακτήρες (και είναι συνήθως ένας πίνακας char) και ο
δείκτης **fp** καθορίζει το αρχείο από το οποίο θα διαβάσει τους χαρακτήρες. Η
συνάρτηση διαβάζει χαρακτήρες μέχρι να διαβάσει είτε ένα χαρακτήρα αλλαγής
γραμμής είτε πλήθος χαρακτήρων όσο η τιμή της παραμέτρου **mikos**. Σε κάθε
περίπτωση η συνάρτηση προσθέτει έναν χαρακτήρα αλλαγής γραμμής στους
χαρακτήρες που διάβασε.

O παρακάτω κώδικας:

- Διαβάζει το πολύ 80 χαρακτήρες από τη πρώτη γραμμή του αρχείου **data** και τους καταχωρίζει στον πίνακα χαρακτήρων **grammi**.
- Εμφανίζει τη γραμμή που διάβασε στην οθόνη.

```c
.....
char grammi[80];
fp=fopen("data","r");
fgets(grammi,80,fp);
puts(grammi);
```

## Η συνάρτηση fgets() - παράδειγμα

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
FILE *fp;

int ar=0;
char grammi[80];

fp=fopen("data","r");

while(!feof(fp)) // Ενόσω δεν έχουμε φτάσει στο τέλος του αρχείου, διαβάζει μία-μία γραμμή και την εμφανίζει στην οθόνη.

{
    fgets(grammi,80,fp); // Διαβάζει το πολύ 80 χαρακτήρες από μια γραμμή του αρχείου και τους καταχωρίζει στον πίνακα χαρακτήρων grammi.
    puts(grammi);
    ar++; // Η μεταβλητή ar μετράει τις γραμμές που διαβάστηκαν.
}

printf("Το αρχείο περιέχει %d γραμμές\n",ar);

fclose(fp);

return 0;
}
```

Στη περίπτωση που κάποια γραμμή του αρχείου έχει περισσότερους από 80 χαρακτήρες, τότε διαβάζονται μόνον οι πρώτοι 80.

## Η συνάρτηση fputs()

H **fputs()** λειτουργεί όπως η puts(), με τη διαφορά ότι γράφει ένα σύνολο χαρακτήρων σε ένα αρχείο. Το συντακτικό της είναι:

```c
fputs(char *str, FILE *fp)
```

όπου ο δείκτης **str** δείχνει την πρώτη από τις θέσεις του συνόλου χαρακτήρων
που θα γραφεί (και είναι συνήθως ένας πίνακας char) και ο δείκτης **fp** καθορίζει το αρχείο στο οποίο θα γραφούν οι χαρακτήρες. **Προσοχή**, η συνάρτηση δεν εγγράφει χαρακτήρα αλλαγής γραμμής στο τέλος των χαρακτήρων.

Το παρακάτω κομμάτι κώδικα:

- Εγγράφει τα περιεχόμενα του πίνακα grammi στο αρχείο out.txt
- Εγγράφει τη λέξη "TELOS" στο αρχείο out.txt

```c
.....
char grammi[80]="XEIRISMOS ARXEIVN";
fp2=fopen("out.txt","w");
fputs(grammi,fp2);
fputs("TELOS",fp2);
.....
```

## Η συνάρτηση fputs() - παράδειγμα

Ο επόμενος κώδικας διαβάζει από ένα αρχείο κειμένου in.txt μία-μία γραμμή και αν αυτή η γραμμή αρχίζει από 'Α', τη γράφει σε ένα άλλο αρχείο out.txt.

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
    FILE *fp1,*fp2;

    char grammi[80];

    fp1=fopen("in.txt","r");
    fp2=fopen("out.txt","w");

    while(!feof(fp1))
    {
        fgets(grammi,80,fp1); // Διαβάζει 80 χαρακτήρες από το αρχείο in.txt και τους αποθηκεύει στον πίνακα grammi.
        if(grammi[0]=='A') // Ελέγχει αν ο πρώτος χαρακτήρας της γραμμής είναι ο χαρακτήρας 'A'.
            fputs(grammi,fp2); // Αν η γραμμή αρχίζει από ' Α' τη γράφει στο αρχείο out.txt.
    }

    fclose(fp1);
    fclose(fp2);

    return 0;
}
```
